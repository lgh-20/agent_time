<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GLM-4 报时机器人</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:#f2f2f7;display:flex;justify-content:center;align-items:center;height:100vh}
    .chat-container{width:400px;height:600px;background:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.12);display:flex;flex-direction:column;overflow:hidden}
    .chat-header{background:#007aff;color:#fff;padding:14px 16px;font-size:16px;font-weight:500}
    .chat-body{flex:1;padding:12px;overflow-y:auto}
    .msg{margin-bottom:12px;display:flex;align-items:flex-end}
    .msg.user{flex-direction:row-reverse}
    .avatar{width:32px;height:32px;border-radius:50%;background:#007aff;color:#fff;display:flex;align-items:center;justify-content:center;font-size:13px}
    .msg.user .avatar{background:#34c759}
    .bubble{max-width:240px;padding:8px 12px;border-radius:16px;font-size:14px;line-height:1.4;margin:0 8px}
    .msg.bot .bubble{background:#f1f1f1;color:#000}
    .msg.user .bubble{background:#007aff;color:#fff}
    .chat-footer{display:flex;padding:8px;border-top:1px solid #e5e5ea;background:#fafafa}
    #inp{flex:1;padding:8px 12px;border:1px solid #d1d1d6;border-radius:16px;outline:none;font-size:14px}
    #sendBtn{margin-left:8px;padding:6px 16px;border:none;border-radius:16px;background:#007aff;color:#fff;font-size:14px;cursor:pointer}
    #sendBtn:hover{background:#005ecb}
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">GLM-4 报时机器人</div>
    <div class="chat-body" id="chat"></div>
    <div class="chat-footer">
      <input id="inp" placeholder="输入消息，按 Enter 发送" />
      <button id="sendBtn" onclick="send()">发送</button>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById('chat');
    const inp     = document.getElementById('inp');
    const API_URL = 'http://localhost:8000/chat';

    function append(msg, who) {
      const row = document.createElement('div');
      row.className = 'msg ' + who;
      row.innerHTML = `
        <div class="avatar">${who === 'user' ? 'U' : 'B'}</div>
        <div class="bubble">${msg}</div>`;
      chatBox.appendChild(row);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function send() {
      const text = inp.value.trim();
      if (!text) return;
      append(text, 'user');
      inp.value = '';
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({user_input: text})
        }).then(r => r.json());
        append(res.response, 'bot');
      } catch (e) {
        append('网络出错了，稍后再试~', 'bot');
      }
    }

    inp.addEventListener('keydown', e => { if (e.key === 'Enter') send(); });
  </script>
</body>
</html>